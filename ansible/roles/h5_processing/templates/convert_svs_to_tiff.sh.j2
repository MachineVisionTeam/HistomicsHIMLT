#!/bin/bash
# SVS to Pyramid TIFF Conversion Script
# Auto-generated by Ansible on {{ ansible_date_time.iso8601 }}

# Usage: ./convert_svs_to_tiff.sh input.svs output.tif

set -e

if [ $# -ne 2 ]; then
    echo "Usage: $0 input.svs output.tif"
    exit 1
fi

INPUT="$1"
OUTPUT="$2"

if [ ! -f "$INPUT" ]; then
    echo "Error: Input file not found: $INPUT"
    exit 1
fi

echo "Converting SVS to Pyramid TIFF..."
echo "Input: $INPUT"
echo "Output: $OUTPUT"

vips tiffsave "$INPUT" "$OUTPUT" \
    --vips-progress \
    --compression=jpeg \
    --Q=99 \
    --tile \
    --tile-width=256 \
    --tile-height=256 \
    --pyramid

echo "Conversion complete!"
echo "Output saved to: $OUTPUT"
echo ""
echo "To view with IIPImage:"
echo "  Copy to: {{ iipimage_images_dir }}"
echo "  Access at: http://{{ apache_server_name }}/iipsrv/iipsrv.fcgi?DeepZoom=$(basename $OUTPUT).dzi"
